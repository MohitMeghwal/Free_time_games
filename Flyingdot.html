<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Flying Dot</title>
  <style>
    :root{
      --overlay-bg: rgba(0,0,0,0.86);
      --accent: #0ff;
      --btn-bg: linear-gradient(90deg,#0ff,#0cc);
      --font: Arial, Helvetica, sans-serif;
    }
    html,body{height:100%;margin:0;padding:0;background:#111;font-family:var(--font);overflow:hidden}
    canvas{position:absolute;left:0;top:0;width:100vw;height:100vh;display:block;background:#87ceeb}
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:5;pointer-events:none}
    .card{width:92%;max-width:420px;background:var(--overlay-bg);color:#fff;text-align:center;padding:18px;border-radius:10px;pointer-events:auto}
    h1,h2{margin:6px 0}
    p{margin:6px 0 0}
    .btn{margin-top:14px;padding:12px 18px;border-radius:8px;border:0;background:var(--btn-bg);color:#012;font-weight:700;cursor:pointer}
    .small{font-size:13px;margin-top:8px;opacity:0.9}
    #scoreBox{position:fixed;top:12px;left:12px;color:#fff;font-weight:700;z-index:6;text-shadow:0 2px 8px rgba(0,0,0,0.6);pointer-events:none}
    #bestBox{position:fixed;top:12px;left:50%;transform:translateX(-50%);color:#fff;font-weight:700;z-index:6;text-shadow:0 2px 8px rgba(0,0,0,0.6);pointer-events:none}
    .hidden{display:none}
  </style>
</head>
<body>
  <canvas id="game"></canvas>

  <div id="startOverlay" class="overlay">
    <div class="card">
      <h1>Flying-Dot</h1>
      <p class="small">Tap / Click / Space to fly. Avoid pipes . survive as long as you can.</p>
      <button id="btnStart" class="btn">Start</button>
    </div>
  </div>

  <div id="gameOverOverlay" class="overlay hidden">
    <div class="card">
      <h2>Game Over</h2>
      <p id="finalScore">Score: 0</p>
      <p id="bestScore" class="small">HighScore: 0</p>
      <button id="btnRestart" class="btn">Restart</button>
    </div>
  </div>

  <div id="scoreBox">Score: <span id="scoreNum">0</span></div>
  <div id="bestBox">HighScore: <span id="bestNum">0</span></div>

  <!-- Audio -->
  <audio id="jumpAudio" preload="auto">
    <source type="audio/wav" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAAAA/////wAAAP//AAD//wAA//8AAP//AAD///8AAAAA"/>
  </audio>
  <audio id="bgAudio" preload="auto" loop>
    <source type="audio/wav" src="data:audio/wav;base64,UklGRlQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAACAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg"/>
  </audio>

<script>
const canvas=document.getElementById('game');const ctx=canvas.getContext('2d',{alpha:false});
const startOverlay=document.getElementById('startOverlay'),gameOverOverlay=document.getElementById('gameOverOverlay');
const btnStart=document.getElementById('btnStart'),btnRestart=document.getElementById('btnRestart');
const hudScore=document.getElementById('scoreNum'),hudBest=document.getElementById('bestNum'),finalScore=document.getElementById('finalScore'),bestScoreEl=document.getElementById('bestScore');
const jumpAudio=document.getElementById('jumpAudio'),bgAudio=document.getElementById('bgAudio');
let BASE_W=360,BASE_H=640,DPR=1;function resize(){DPR=Math.max(1,window.devicePixelRatio||1);canvas.width=window.innerWidth*DPR;canvas.height=window.innerHeight*DPR;ctx.setTransform(canvas.width/BASE_W,0,0,canvas.height/BASE_H,0,0);}resize();window.addEventListener('resize',resize);
let running=false,pipes=[],particles=[],score=0,best=parseInt(localStorage.getItem('flying_dot_best')||'0',10)||0,lastTimestamp=0,spawnTimer=0,spawnInterval=1400,pipeSpeed=2,gapSize=180,gravity=0.18,jumpPower=-5.0;
hudBest.textContent=best;let player={x:80,y:BASE_H/2,r:12,vy:0};
function rand(a,b){return Math.random()*(b-a)+a;}function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
function resetGame(){player={x:80,y:BASE_H/2,r:12,vy:0};pipes=[];particles=[];score=0;spawnTimer=0;spawnInterval=1400;pipeSpeed=2;gapSize=180;hudScore.textContent=0;}
function spawnPipe(){let top=clamp(rand(36,BASE_H-gapSize-80),36,BASE_H-gapSize-80);pipes.push({x:BASE_W+40,w:56,top,passed:false});}
function createParticles(x,y,n=6){for(let i=0;i<n;i++){particles.push({x,y,vx:rand(-2,2),vy:rand(-1.5,0.5),life:30,r:rand(1,3)});}}
function updateParticles(){particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=0.05;p.life--;});particles=particles.filter(p=>p.life>0);}
function circleRect(cx,cy,r,rx,ry,rw,rh){const nx=clamp(cx,rx,rx+rw),ny=clamp(cy,ry,ry+rh);return((cx-nx)**2+(cy-ny)**2)<=r*r;}
function updateDifficulty(){let t=clamp(score/50,0,1);pipeSpeed=2+3*t;gapSize=180-60*t;spawnInterval=1400-400*t;}
function drawBG(){ctx.fillStyle=`hsl(${200+(score%100)},70%,70%)`;ctx.fillRect(0,0,BASE_W,BASE_H);}
function draw(){drawBG();pipes.forEach(p=>{ctx.fillStyle="#0f8";ctx.fillRect(p.x,0,p.w,p.top);ctx.fillRect(p.x,p.top+gapSize,p.w,BASE_H);});particles.forEach(p=>{ctx.fillStyle="rgba(0,191,255,.7)";ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,2*Math.PI);ctx.fill();});ctx.font="26px Arial";ctx.fillText("ü•è",player.x-12,player.y+10);}
function step(ts){if(!lastTimestamp)lastTimestamp=ts;let dt=ts-lastTimestamp;lastTimestamp=ts;if(!running)return;spawnTimer+=dt;if(spawnTimer>spawnInterval){spawnPipe();spawnTimer=0;}player.vy+=gravity;player.y+=player.vy;let move=pipeSpeed*(dt/16);pipes.forEach(p=>{p.x-=move;if(!p.passed&&p.x+p.w<player.x){p.passed=true;score++;hudScore.textContent=score;updateDifficulty();}});pipes=pipes.filter(p=>p.x>-60);updateParticles();if(player.y<0||player.y>BASE_H)return gameOver();for(const p of pipes){if(circleRect(player.x,player.y,player.r,p.x,0,p.w,p.top)||circleRect(player.x,player.y,player.r,p.x,p.top+gapSize,p.w,BASE_H))return gameOver();}draw();requestAnimationFrame(step);}
function jump(){if(!running)return;player.vy=jumpPower;createParticles(player.x,player.y);jumpAudio.currentTime=0;jumpAudio.play().catch(()=>{});}
function start(){resetGame();startOverlay.classList.add("hidden");gameOverOverlay.classList.add("hidden");running=true;lastTimestamp=0;bgAudio.currentTime=0;bgAudio.play().catch(()=>{});requestAnimationFrame(step);}
function gameOver(){running=false;bgAudio.pause();if(score>best){best=score;localStorage.setItem('flying_dot_best',best);}finalScore.textContent="Score: "+score;hudBest.textContent=best;bestScoreEl.textContent="HighScore: "+best;gameOverOverlay.classList.remove("hidden");}
canvas.addEventListener("pointerdown",e=>{if(!running)start();else jump();});window.addEventListener("keydown",e=>{if(e.code==="Space"){if(!running)start();else jump();}});
btnStart.onclick=()=>start();btnRestart.onclick=()=>start();drawBG();ctx.font="26px Arial";ctx.fillText("ü•è",player.x-12,player.y+10);
</script>
</body>
</html>
