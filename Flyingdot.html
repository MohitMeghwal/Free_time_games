<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <title>Fly the Dot</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      touch-action: manipulation;
      font-family: Arial, sans-serif;
      height: 100vh;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: linear-gradient(#87ceeb, #fff);
      border-left: 4px solid #0ff;
      border-right: 4px solid #0ff;
      max-width: 100vw;
      max-height: 100vh;
    }
    .overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.85);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      text-align: center;
    }
    button {
      padding: 12px 24px;
      font-size: 18px;
      background: #0ff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background: #0cc;
    }
  </style>
</head>
<body>

<canvas id="game"></canvas>

<div id="startScreen" class="overlay">
  <h1>Fly the Dot</h1>
  <p>Tap to fly and avoid pipes</p>
  <button onclick="startGame()">Start</button>
</div>

<div id="gameOverScreen" class="overlay" style="display:none;">
  <h2>Game Over</h2>
  <p id="scoreDisplay"></p>
  <p id="highScoreDisplay"></p>
  <button onclick="restartGame()">Restart</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let dot, pipes, gravity, jumpPower, pipeSpeed, gapSize;
let score = 0;
let highScore = localStorage.getItem("flyHighScore") || 0;
let gameRunning = false;
let animationId;

// Set base dimensions
const baseWidth = 360;
const baseHeight = 640;

// Resize canvas to maintain aspect ratio and scale
function resizeCanvas() {
  const scale = Math.min(window.innerWidth / baseWidth, window.innerHeight / baseHeight);
  canvas.width = baseWidth;
  canvas.height = baseHeight;
  canvas.style.width = baseWidth * scale + "px";
  canvas.style.height = baseHeight * scale + "px";
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

function resetGame() {
  dot = { x: 80, y: 300, r: 12, vy: 0 };
  pipes = [];
  gravity = 0.18;
  jumpPower = -5.5;
  pipeSpeed = 1.2;
  gapSize = 260;
  score = 0;
}

function spawnPipe() {
  const top = Math.random() * 200 + 50;
  const bottom = canvas.height - top - gapSize;
  pipes.push({ x: canvas.width, w: 50, top: top, bottom: bottom });
}

function drawDot() {
  ctx.beginPath();
  ctx.fillStyle = "#f0f";
  ctx.arc(dot.x, dot.y, dot.r, 0, Math.PI * 2);
  ctx.fill();
}

function drawPipes() {
  ctx.fillStyle = "#0c0";
  for (let p of pipes) {
    ctx.fillRect(p.x, 0, p.w, p.top);
    ctx.fillRect(p.x, canvas.height - p.bottom, p.w, p.bottom);
  }
}

function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#87ceeb";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  dot.vy += gravity;
  dot.y += dot.vy;

  for (let p of pipes) p.x -= pipeSpeed;
  pipes = pipes.filter(p => p.x + p.w > 0);
  if (Math.random() < 0.012) spawnPipe();

  for (let p of pipes) {
    if (
      dot.x + dot.r > p.x && dot.x - dot.r < p.x + p.w &&
      (dot.y - dot.r < p.top || dot.y + dot.r > canvas.height - p.bottom)
    ) {
      return endGame();
    }
  }

  if (dot.y - dot.r < 0 || dot.y + dot.r > canvas.height) return endGame();

  drawPipes();
  drawDot();

  ctx.fillStyle = "#fff";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 30);
  score++;

  animationId = requestAnimationFrame(update);
}

function fly() {
  if (!gameRunning) return;
  dot.vy = jumpPower;
}

function startGame() {
  document.getElementById("startScreen").style.display = "none";
  document.getElementById("gameOverScreen").style.display = "none";
  resetGame();
  gameRunning = true;
  update();
}

function endGame() {
  cancelAnimationFrame(animationId);
  gameRunning = false;
  if (score > highScore) {
    highScore = score;
    localStorage.setItem("flyHighScore", highScore);
  }
  document.getElementById("scoreDisplay").textContent = "Score: " + score;
  document.getElementById("highScoreDisplay").textContent = "High Score: " + highScore;
  document.getElementById("gameOverScreen").style.display = "flex";
}

function restartGame() {
  startGame();
}

canvas.addEventListener("click", fly);
canvas.addEventListener("touchstart", fly);
document.addEventListener("keydown", (e) => {
  if (e.key === " " || e.key === "ArrowUp") fly();
});
</script>

</body>
</html>
